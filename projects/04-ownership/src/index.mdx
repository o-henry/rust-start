# Memory management

http://web.mit.edu/rust-lang_v1.25/arch/amd64_ubuntu1404/share/doc/rust/html/book/first-edition/the-stack-and-the-heap.html#memory-management

## Stack

- 매우 빠르다
- Rust는 기본적으로 스택에 값을 할당(allocate) 한다.
- 할당은 함수를 호출할때 로컬에서 일어난다.
- 크기 제한이 있다.

```rust
fn main() {
    let x = 42;
}
```

위 함수는 `x` 변수를 바인딩 합니다. 이 메모리는 어딘가에 할당할 필요가 있습니다. Rust는 기본적으로 stack에 할당 합니다.
함수가 호출될때, 지역 변수와 다른 몇몇 정보들이 메모리에 할당 됩니다. 이를 `stack frame`이라고 부릅니다.
위 `main` 함수가 실행될때, 우리는 우리의 스택 프레임에 32비트 정수를 할당합니다. 위 과정은 자동으로 이루어지며 따로 코드를 작성하거나 할 필요가 없습니다.

함수가 종료되면 스택프레임의 할당이 취소됩니다. ({ } 표현식이 끝날때 drop 됩니다.)

위 과정에서 일어나는 스택 할당은 매우 매우 빠릅니다.
단점은, 우리가 더 오래 동안 필요로 할때 값이 오래 유지되지 않는다는 것 입니다.

## Heap

- 느리다
- 명시적으로 할당한다. (스택 은 기본적으로 자동으로 할당된다.)
- 전역에서 접근 가능하다.
- 크기 제한이 없다.
- 자료구조의 힙과는 차이가 있다.

때떄로, 다른 함수들 사이에서 메모리를 넘길 필요가 있거나, 좀더 오래 메모리에서 유지시키고 싶을때 Heap을 사용합니다.

```rust
fn main() {
    let x = Box::new(5);
    let y = 42;
}
```

러스트에서는 `Box<T>` 타입으로 힙에 메모리를 할당할 수 있습니다. main 함수가 실행될때, 스택에 x와 y 두 변수의 공간을 할당합니다.
y는 42로 할당되지만, x는 어떨까요? x는 `Box<i32>`로 heap에 메모리를 할당합니다. 실제 값은 heap에 대한 포인터가 있는 구조 입니다.
